/*!
 * x-app v0.0.6
 * https://github.com/jaysalvat/x-app
 */
var t,e;t=this,e=function(){"use strict";function t(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function e(t,e){var n;for(var i in t.forEach&&(t=Array.from(t),n=!0),t)if(t.hasOwnProperty(i)&&!1===e.apply(this,[t[i],n?parseInt(i):i]))break}function n(){return Object.assign.apply(this,arguments)}var i=/\{\{\s?(.*?)\s?\}\}/g,r=/((^|[^\\.\w])([a-zA-Z_$][0-9a-zA-Z_$]*))(?=(?:[^'"]|['"][^'"]*['"])*$)/g,s=/( ?\| ?\w+(\(.*\))?)/g,a="http://www.w3.org/2000/svg",u,o,c;function f(t){return u=1,o={},c={},{map:l(t),mixins:o,includes:c}}function l(t,i){void 0===i&&(i=!1);var r={};if(1===t.nodeType){var s,a={},u={};if(e(t.attributes,(function(e){"x-verbatim"===e.name&&(i="off"!==e.value.toLowerCase(),t.removeAttribute(e.name))})),e(t.attributes,(function(e){var n=e.name,r=e.value;if(i||0!==n.indexOf("x-"))a[n]=h(r,i);else switch(n){case"x-for":u.for=r.split(/\s*in\s*/);break;case"x-use":u.use=r.split(/\s*with\s*/);break;case"x-include":t.removeAttribute(n),u.use=r.split(/\s*with\s*/),o[u.use[0]]=l(t),c[u.use[0]]=!1;break;case"x-mixin":t.removeAttribute(n),o[r]=l(t),t.remove(),s=!0;break;default:u[n.replace("x-","")]=r}})),s)return;return r.tagName=t.tagName,r.attrs=a,r.svg=void 0!==t.ownerSVGElement,r.x=u,r.children=p(t,i),r}if(3===t.nodeType){var f=t.nodeValue.replace(/^\s{1,}|\s{1,}$/g," ");return f&&n(r,h(f,i)),r}}function p(t,n){void 0===n&&(n=!1);var i=[];return e(t.childNodes,(function(t){var e=l(t,n);e&&i.push(e)})),i}function h(t,e){var n={};return e||(t=t.replace(i,(function(t,e){var i="x"+u++,r=d(e);return n[i]={value:r.value||e,pipes:r.pipes||[]},"{{ "+i+" }}"}))),{x:n,text:t}}function d(t){var e=t.match(s);return e?{value:t=t.replace(e.join(""),"").trim(),pipes:e=e.map((function(t){var e=(t=t.replace(/^( ?\| ?)/,"")).match(/(\w+)(\((.+)\))?/);return{name:e[1],args:"["+(e[3]||"")+"]"||"[]"}}))}:{}}function m(t){return Array.isArray(t)}function v(t){return"string"==typeof t}function x(t){return"function"==typeof t}function g(t){return void 0===t}function y(t){return t instanceof HTMLElement}function w(t){if(v(t))return document.createTextNode(t);var n,i=t.tagName,r=t.attrs,s=t.children;return n=t.svg?document.createElementNS(a,i):document.createElement(i),e(r,(function(t,e){n.setAttribute(e,t)})),e(s,(function(t){n.appendChild(w(t))})),n}function b(t,n){var i=[];return e(n,(function(t,e){i.push((function(n){return"innerHTML"===e?n.innerHTML=t:n.setAttribute(e,t),n}))})),e(t,(function(t,e){e in n||i.push((function(t){return t.removeAttribute(e),t}))})),function(t){e(i,(function(e){e&&e(t)}))}}function _(t,n){var i=[],r=[];return e(t,(function(t,e){i.push(M(t,n[e]))})),e(n.slice(t.length),(function(t){r.push((function(e){return e.appendChild(w(t)),e}))})),function(t){return e(t.childNodes,(function(t,e){i[e]&&i[e](t)})),e(r,(function(e){e&&e(t)})),t}}function M(t,e){if(!e)return function(t){t.remove()};if(v(t)||v(e))return t!==e?function(t){var n=w(e);return t.replaceWith(n),n}:function(){};if(t.tagName!==e.tagName)return function(t){var n=w(e);return t.replaceWith(n),n};var n=b(t.attrs,e.attrs),i=_(t.children,e.children);return function(t){return n(t),i(t),t}}function T(t){return t.charAt(0).toUpperCase()+t.slice(1)}function $(t,e){return void 0===e&&(e=4),JSON.stringify(t,null,e)}function D(t){return t.toLowerCase()}function j(t){return t.split(" ").map((function(t){return T(t)})).join(" ")}function L(t,e,n){return t.length>e?t.substr(0,e)+(n||"…"):t}function N(t){return t.toUpperCase()}function O(t){return JSON.parse(JSON.stringify(t))}function A(t){var e=Object.keys(this);if(t=t.replace(r,(function(t,n,i,r){return e.includes(r)?i+"this."+r:t})),y(window[t]))return!1;if(!g(window[t]))throw Error(t+" is not defined");return eval("("+t+")")}function E(t){var e=document.createElement("div");return e.innerHTML=t.trim(),Array.from(e.childNodes)[0]}function C(t){return e(t,(function(t){if(t&&"object"==typeof t)return C(t);"string"==typeof t&&(t=t.replace(i,(function(t,e){return e})))})),t}var H=[].slice.call(window.getComputedStyle(document.body)),V=k();function k(){return(H.join("|").match(/[|\b]-(moz|webkit|ms)/)||[])[1]}function S(t,e){var n=t.replace(/[A-Z]/g,(function(t){return"-"+t.toLowerCase()})).trim(),i="-"+V+"-"+n;return e&&H.includes(i)&&(n=i),n}var F=function(){function t(e,i){void 0===e&&(e=document.body),this._settings=n({},t._settings,i),this._pipes=n({},t._pipes),this._mixins=O(t._mixins),this._connectors=[],this.$el=this.setDOMObject(e);var r=f(this.$el),s=r.map,a=r.includes;this._mixins=n({},this._mixins,r.mixins),this.includes=a,this.loadIncludes(),this.vMap=s,this.vDom=this.createVDomFromMap(this.vMap),this.data={}}t.settings=function(e){return e&&n(t._settings,e),t._settings},t.mixins=function(e){return e&&n(t._mixins,e),t._mixins},t.pipes=function(e){return e&&n(t._pipes,e),t._pipes};var r=t.prototype;return r.loadIncludes=function(t){var i=this,r=0;e(t=t||this.includes,(function(e,s){if(!i.includes[s]){i.includes[s]=!0;var a=new XMLHttpRequest;a.open("GET",s,!0),a.send(),a.onreadystatechange=function(){if(4===a.readyState){if(200===a.status){var e=f(E(a.responseText)),u=e.map,o=e.mixins;i.loadIncludes(e.includes),i._mixins=n({},i._mixins,o),i._mixins[s]=u}++r===Object.keys(t).length&&i.render()}}}}))},r.settings=function(t){return t&&n(this._settings,t),this._settings},r.mixins=function(t){var n=this;return t&&e(t,(function(t,e){t.nodeType?(n._mixins[e]=f(t).map,t.remove()):v(t)&&(n._mixins[e]=f(E(t)).map)})),this._mixins},r.pipes=function(t){return t&&n(this._pipes,t),this._pipes},r.setDOMObject=function(t){var e;return(e=v(t)?t.match(/^\s*<(\w+|!)[^>]*>/)?E(t):document.querySelector(t):t)||(this.warn("Element “"+t+"“ does not exist."),e=document.createElement("div")),"text/template"===e.getAttribute("type")&&(e=E(e.innerHTML),this.isContainer=!0),this.$el=e,e},r.getDOMObject=function(){return this.$el},r.getHTML=function(){return this.$el.outerHTML},r.getVDom=function(){return this.vDom},r.getVMap=function(){return this.vMap},r.setData=function(t){this.data=C(t||this.data||{})},r.connect=function(t){return v(t)&&(t=document.querySelector(t)),t?this.isContainer?void this._connectors.push(t):this.warn("Template must be type=“text/template“ to be connected."):this.warn("Connector “"+t+"“ does not exist.")},r.render=function(t,n){var i=this;x(t)&&!n&&(n=t,t=null),this.setData(t),this.triggerEvent("before"),delete this.vMap.attrs.hidden;var r=this.createVDomFromMap(this.vMap,this.data),s=M(this.vDom,r);return this.vDom=O(r),this.$el=s(this.$el),this.applyData(this.$el,r),this.triggerEvent("after"),e(this._connectors,(function(t){t.innerHTML=i.getHTML()})),x(n)&&n.call(this.$el,this.$el),this.getHTML()},r.applyData=function(t,n){var i=this;t["x-data"]=n&&n.data?n.data():this.data,e(t.childNodes,(function(t,e){i.applyData(t,n&&n.children[e])}))},r.createVDomFromMap=function(t,i){var r=this,s={data:function(){return i}};if(t=O(t),i){if(t.x.for){var a=[],u=t.x.for,o=u[0],c=this.eval(u[1],i)||[];return delete t.x.for,m(c)||(c=Object.keys(c)),e(c,(function(e,s){var u,f=n({},i,((u={$first:0===s,$index:s,$last:s===c.length-1})[o]=e,u));a.push(r.createVDomFromMap(O(t),f))})),a}if(t.x.use){var f=t.x.use,l=f[0],p=f[1],h=this._mixins[l];if(!h)return this.warn("Template “"+l+"“ does not exist.");delete t.x.use;var d=n(i,this.eval("("+p+")",i)),v=O(h);return v.x=Object.assign({},h.x,t.x),this.createVDomFromMap(v,d)}if(t.x.if&&!this.eval(t.x.if,i))return;if(t.attrs){var x={};e(t.attrs,(function(t,e){x[e]=r.replaceTags(t.text,i,t.x)})),t.attrs=x}if(t.x.html&&(t.attrs.innerHTML=this.eval(t.x.html,i)),e(["src","srcset","href"],(function(e){t.x[e]&&(t.attrs[e]=r.eval(t.x[e],i))})),t.x.attr&&e(this.eval(t.x.attr,i)||[],(function(e,n){!1===e||null==e?delete t.attrs[n]:t.attrs[n]=!0===e?n:e})),t.x.class){var g=[],y=this.eval(t.x.class,i),w=(t.attrs.class||"").split(" ");e(y,(function(t,e){!0===t&&g.push(e)})),e(w,(function(t){!1!==y[t]&&g.push(t)})),t.attrs.class=g.join(" ").trim()}if(t.x.style){var b=[],_=this._settings.cssPrefix,M=this.eval(t.x.style,i);e(t.attrs.style?t.attrs.style.split(/ ?; ?/):[],(function(t){var e=t.split(/ ?: ?/),n=e[1];b.push(S(e[0],_)+": "+n)})),e(M,(function(t,e){b.push(S(e,_)+": "+t)})),t.attrs.style=b.join("; ").trim()}}return t.text?s=this.replaceTags(t.text,i,t.x):t.tagName&&(s.tagName=t.tagName,s.svg=t.svg,s.attrs=t.attrs||{},s.children=[],!i&&s.attrs&&e(t.x,(function(t,e){s.attrs["x-"+e]=!0}))),t.children&&e(t.children,(function(t){var n=r.createVDomFromMap(t,i);m(n)?e(n,(function(t){t&&s.children.push(t)})):n&&s.children.push(n)})),s},r.replaceTags=function(t,e,n){var r=this;return e?t.replace(i,(function(i,s){if(!n[s])return t;var a=r.eval(n[s].value,e),u=r.applyPipes(a,n[s].pipes,e);return void 0===u?"":u})):t},r.applyPipes=function(t,n,i){var r=this;return e(n,(function(e){var n=e.name,s=e.args,a=r._pipes[n];a?(s=r.eval(s,i),t=a.apply(i,[t].concat(s))):r.warn("”"+n+"” pipe does not exist.")})),t},r.triggerEvent=function(t){var e=new CustomEvent("x-"+t,{detail:{template:this.$el,data:this.data}});document.dispatchEvent(e),this._settings[t+"Render"].call(this.$el,this.$el,this.data)},r.eval=function(t,e){if(!e)return t;try{return A.call(e,t)}catch(e){this.warn("”"+t+"”:",e.message)}},r.warn=function(){var t=Array.from(arguments),e="Xapp — "+t.join(" ");if(1===this._settings.warningLevel)console.warn(e);else if(2===this._settings.warningLevel)throw Error(e)},t}();return t(F,"_mixins",{}),t(F,"_settings",{cssPrefix:!0,warningLevel:1,beforeRender:function(){},afterRender:function(){}}),t(F,"_pipes",{firstcap:T,json:$,lower:D,title:j,truncate:L,upper:N}),F},"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).Xapp=e();
